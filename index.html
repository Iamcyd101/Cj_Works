import React, { useState, useEffect } from 'react';
import { Zap, Brain, BookOpen, Crown, CheckCircle, XCircle, ArrowRight, Lightbulb } from 'lucide-react';

// --- Data Structure for Rounds & Questions ---
const gameData = [
    {
        id: 1,
        title: "Round 1: Speed & Accuracy",
        color: "bg-green-500",
        icon: Zap,
        questions: [
            { q: "2, 4, 6, ___, 10", a: "8", type: "input", hint: "Skip counting by 2s" },
            { q: "8 + 7 = ?", a: "15", type: "input" },
            { q: "15 - 9 = ?", a: "6", type: "input" },
            { q: "Which number is the biggest?", options: ["8", "12", "20", "1"], a: "20", type: "mcq" },
            { q: "Write 'Twelve' in numbers.", a: "12", type: "input" }
        ]
    },
    {
        id: 2,
        title: "Round 2: Logical Thinking",
        color: "bg-blue-500",
        icon: Brain,
        questions: [
            { q: "5 + â­ = 12. What is â­?", a: "7", type: "input" },
            { q: "Triangle, Circle, Triangle, Triangle, Circle, Triangle, Triangle, Triangle... What comes next?", options: ["Triangle", "Circle", "Square"], a: "Circle", type: "mcq" },
            { q: "I am > 10 and < 15. If you add 1 to me, I become 14. What am I?", a: "13", type: "input" },
            { q: "Balance: 4 + 6 = ___ + 5", a: "5", type: "input" },
            { q: "How many small triangles in a square with an X inside?", options: ["2", "4", "8"], a: "4", type: "mcq" }
        ]
    },
    {
        id: 3,
        title: "Round 3: Word Problems",
        color: "bg-orange-500",
        icon: BookOpen,
        questions: [
            { q: "Cat is 3rd. Dog is Last. There are 4 animals between them. What position is Dog?", a: "8", type: "input", suffix: "th" },
            { q: "Ken has 10 candies. Gives Tim 3. Gives Ben 5. How many left?", a: "2", type: "input" },
            { q: "Bus has 8 kids. 3 get off. 5 get on. Total now?", a: "10", type: "input" }
        ]
    },
    {
        id: 4,
        title: "Round 4: Genius Challenge",
        color: "bg-purple-600",
        icon: Crown,
        questions: [
            { q: "Cards: 1, 5, 9. Make the largest 2-digit number.", a: "95", type: "input" },
            { q: "Sam is 6. In 3 years, he will be half his sister's age. How old is sister NOW?", a: "15", type: "input", hint: "Sam will be 9. Sister will be 18." }
        ]
    }
];

export default function App() {
    const [gameState, setGameState] = useState('welcome'); // welcome, roundIntro, playing, result
    const [currentRoundIdx, setCurrentRoundIdx] = useState(0);
    const [currentQIdx, setCurrentQIdx] = useState(0);
    const [score, setScore] = useState(0);
    const [inputVal, setInputVal] = useState("");
    const [feedback, setFeedback] = useState(null); // 'correct', 'wrong', null

    const currentRound = gameData[currentRoundIdx];
    const currentQ = currentRound ? currentRound.questions[currentQIdx] : null;

    // --- Handlers ---
    const startGame = () => {
        setGameState('roundIntro');
    };

    const startRound = () => {
        setGameState('playing');
    };

    const handleAnswer = (val) => {
        const isCorrect = val.toString().toLowerCase() === currentQ.a.toString().toLowerCase();
        
        if (isCorrect) {
            setScore(s => s + 10); // 10 points per question
            setFeedback('correct');
        } else {
            setFeedback('wrong');
        }

        // Delay to show feedback then move next
        setTimeout(() => {
            setFeedback(null);
            setInputVal("");
            
            if (currentQIdx + 1 < currentRound.questions.length) {
                setCurrentQIdx(c => c + 1);
            } else {
                // End of Round
                if (currentRoundIdx + 1 < gameData.length) {
                    setCurrentRoundIdx(c => c + 1);
                    setCurrentQIdx(0);
                    setGameState('roundIntro');
                } else {
                    setGameState('result');
                }
            }
        }, 1500);
    };

    const handleKey = (e) => {
        if (e.key === 'Enter') handleAnswer(inputVal);
    }

    // --- Render Logic ---

    if (gameState === 'welcome') {
        return (
            <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-blue-400 to-indigo-600 text-white p-4 font-sans">
                <style>{`
                    @keyframes bounce-short {
                        0%, 100% { transform: translateY(-5%); }
                        50% { transform: translateY(0); }
                    }
                    .animate-bounce-short { animation: bounce-short 0.5s infinite; }
                `}</style>
                <div className="text-6xl mb-4 animate-bounce-short">ðŸ§®</div>
                <h1 className="text-4xl md:text-6xl font-bold text-center mb-6">Math Competition<br/><span className="text-2xl opacity-90">Term 1 Challenge</span></h1>
                <p className="text-xl mb-8 text-center max-w-md">Are you ready to test your Speed, Logic, and Problem Solving?</p>
                <button onClick={startGame} className="bg-yellow-400 hover:bg-yellow-300 text-yellow-900 font-bold py-4 px-10 rounded-full shadow-lg transform transition hover:scale-105 text-xl">
                    Start Exam
                </button>
            </div>
        );
    }

    if (gameState === 'roundIntro') {
        const IconComponent = currentRound.icon;
        return (
            <div className={`min-h-screen flex flex-col items-center justify-center text-white p-4 ${currentRound.color} font-sans`}>
                <IconComponent className="w-24 h-24 mb-6 opacity-80" />
                <h2 className="text-3xl font-bold uppercase tracking-wider mb-2">Coming Up</h2>
                <h1 className="text-5xl md:text-6xl font-bold text-center mb-8">{currentRound.title}</h1>
                <button onClick={startRound} className="bg-white text-gray-900 font-bold py-3 px-12 rounded-full shadow-xl hover:bg-gray-100 transition text-xl">
                    Ready!
                </button>
            </div>
        );
    }

    if (gameState === 'result') {
        const totalQ = gameData.reduce((acc, r) => acc + r.questions.length, 0);
        const maxScore = totalQ * 10;
        const percentage = Math.round((score / maxScore) * 100);
        
        let message = "";
        if (percentage >= 90) message = "ðŸ† Gold Medal Standard!";
        else if (percentage >= 70) message = "ðŸ¥ˆ Silver Medal Standard!";
        else if (percentage >= 50) message = "ðŸ¥‰ Bronze Medal Standard!";
        else message = "Good Effort! Keep Practicing.";

        return (
            <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 font-sans">
                <h1 className="text-5xl font-bold mb-4">Exam Complete!</h1>
                <div className="bg-white text-gray-800 p-8 rounded-2xl shadow-2xl text-center max-w-md w-full">
                    <p className="text-gray-500 uppercase tracking-widest font-bold text-sm mb-2">Final Score</p>
                    <div className="text-6xl font-bold text-purple-600 mb-4">{score} <span className="text-2xl text-gray-400">/ {maxScore}</span></div>
                    <div className="w-full bg-gray-200 rounded-full h-4 mb-6">
                        <div className="bg-purple-600 h-4 rounded-full" style={{width: `${percentage}%`}}></div>
                    </div>
                    <p className="text-2xl font-bold mb-6">{message}</p>
                    <button onClick={() => window.location.reload()} className="bg-gray-900 text-white py-3 px-8 rounded-xl hover:bg-gray-700 transition">
                        Try Again
                    </button>
                </div>
            </div>
        );
    }

    const IconComponent = currentRound.icon;

    // --- Playing State ---
    return (
        <div className="min-h-screen bg-gray-100 flex flex-col items-center justify-center p-4 font-sans selection:bg-yellow-200">
            {/* Top Bar */}
            <div className="absolute top-0 left-0 w-full p-4 flex justify-between items-center bg-white shadow-sm z-10">
                <div className="flex items-center gap-2">
                    <span className={`w-3 h-3 rounded-full ${currentRound.color}`}></span>
                    <span className="font-bold text-gray-600 hidden md:block">{currentRound.title}</span>
                </div>
                <div className="font-bold text-xl text-indigo-600">Score: {score}</div>
            </div>

            {/* Question Card */}
            <div className="relative w-full max-w-2xl">
                {/* Feedback Overlay */}
                {feedback && (
                    <div className={`absolute inset-0 z-20 flex items-center justify-center rounded-3xl backdrop-blur-sm ${feedback === 'correct' ? 'bg-green-500/20' : 'bg-red-500/20'}`}>
                         <style>{`
                            @keyframes bounce-short {
                                0%, 100% { transform: translateY(-5%); }
                                50% { transform: translateY(0); }
                            }
                            .animate-bounce-short { animation: bounce-short 0.5s infinite; }
                        `}</style>
                        <div className={`text-6xl md:text-8xl animate-bounce-short ${feedback === 'correct' ? 'text-green-600' : 'text-red-500'}`}>
                            {feedback === 'correct' ? <CheckCircle className="w-24 h-24" /> : <XCircle className="w-24 h-24" />}
                        </div>
                    </div>
                )}

                <div className="bg-white rounded-3xl shadow-xl p-8 md:p-12 border-b-8 border-gray-200">
                    <div className="flex justify-between items-center mb-6">
                        <span className="bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-sm font-bold">
                            Q{currentQIdx + 1} / {currentRound.questions.length}
                        </span>
                        <IconComponent className="text-gray-300 w-8 h-8" />
                    </div>

                    <h2 className="text-3xl md:text-4xl font-bold text-gray-800 mb-8 leading-tight">
                        {currentQ.q}
                    </h2>

                    {/* Input Area */}
                    <div className="space-y-4">
                        {currentQ.type === 'mcq' ? (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {currentQ.options.map((opt, idx) => (
                                    <button 
                                        key={idx}
                                        onClick={() => handleAnswer(opt)}
                                        disabled={feedback !== null}
                                        className="bg-indigo-50 hover:bg-indigo-100 border-2 border-indigo-100 hover:border-indigo-300 text-indigo-900 font-bold py-4 px-6 rounded-xl transition text-lg text-left"
                                    >
                                        {opt}
                                    </button>
                                ))}
                            </div>
                        ) : (
                            <div className="flex gap-2">
                                <input 
                                    type="text" 
                                    value={inputVal}
                                    onChange={(e) => setInputVal(e.target.value)}
                                    onKeyDown={handleKey}
                                    disabled={feedback !== null}
                                    placeholder="Type answer..."
                                    className="w-full bg-gray-50 border-2 border-gray-300 focus:border-indigo-500 rounded-xl px-6 py-4 text-2xl outline-none font-bold text-gray-700"
                                    autoFocus
                                />
                                <button 
                                    onClick={() => handleAnswer(inputVal)}
                                    disabled={!inputVal || feedback !== null}
                                    className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold px-8 rounded-xl text-xl shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    <ArrowRight className="w-6 h-6" />
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Hint if available */}
                    {currentQ.hint && (
                        <div className="mt-6 text-sm text-gray-400 italic flex items-center">
                            <Lightbulb className="w-4 h-4 mr-1 text-yellow-400" />
                            Hint: {currentQ.hint}
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
}
